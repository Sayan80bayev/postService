?   	postService/cmd/server	[no test files]
?   	postService/docs	[no test files]
?   	postService/internal/bootstrap	[no test files]
?   	postService/internal/cache	[no test files]
?   	postService/internal/config	[no test files]
?   	postService/internal/delivery	[no test files]
?   	postService/internal/events	[no test files]
?   	postService/internal/mappers	[no test files]
?   	postService/internal/model	[no test files]
?   	postService/internal/repository	[no test files]
?   	postService/internal/routes	[no test files]
=== RUN   TestPostService_CreatePost_Success
[32mINFO[0m PostCreated event published successfully 2025-08-26 23:14:26
--- PASS: TestPostService_CreatePost_Success (0.00s)
=== RUN   TestPostService_GetPosts_CacheMiss_FetchFromRepo
[32mINFO[0m Fetched posts from DB and cached 2025-08-26 23:14:26
--- PASS: TestPostService_GetPosts_CacheMiss_FetchFromRepo (0.00s)
=== RUN   TestPostService_GetPostByID_CacheMiss
[32mINFO[0m Fetched post cbeab714-dcd1-409f-ae46-d05712a2f09d from DB and cached 2025-08-26 23:14:26
--- PASS: TestPostService_GetPostByID_CacheMiss (0.00s)
=== RUN   TestPostService_DeletePost_PermissionDenied
--- PASS: TestPostService_DeletePost_PermissionDenied (0.00s)
=== RUN   TestPostService_DeletePost_Success
[32mINFO[0m PostDeleted event published successfully 2025-08-26 23:14:26
--- PASS: TestPostService_DeletePost_Success (0.00s)
PASS
ok  	postService/internal/service	0.956s
?   	postService/internal/transfer/request	[no test files]
?   	postService/internal/transfer/response	[no test files]
2025/08/26 23:14:26 github.com/testcontainers/testcontainers-go - Connected to docker: 
  Server Version: 28.3.0
  API Version: 1.50
  Operating System: Docker Desktop
  Total Memory: 3919 MB
  Labels:
    com.docker.desktop.address=unix:///Users/sayanseksenbaev/Library/Containers/com.docker.docker/Data/docker-cli.sock
  Testcontainers for Go Version: v0.38.0
  Resolved Docker Host: unix:///var/run/docker.sock
  Resolved Docker Socket Path: /var/run/docker.sock
  Test SessionID: d72b25a10cde91f01b8be8056255d3222cdf499db9f14e654a1d28080b6ad5b5
  Test ProcessID: 43b09337-aac3-42ba-8b8e-ee5c080be7da
2025/08/26 23:14:26 üê≥ Creating container for image testcontainers/ryuk:0.12.0
2025/08/26 23:14:26 ‚úÖ Container created: ac48cb46ccd8
2025/08/26 23:14:26 üê≥ Starting container: ac48cb46ccd8
2025/08/26 23:14:26 ‚úÖ Container started: ac48cb46ccd8
2025/08/26 23:14:26 ‚è≥ Waiting for container id ac48cb46ccd8 image: testcontainers/ryuk:0.12.0. Waiting for: &{Port:8080/tcp timeout:<nil> PollInterval:100ms skipInternalCheck:false skipExternalCheck:false}
2025/08/26 23:14:26 üîî Container is ready: ac48cb46ccd8
2025/08/26 23:14:26 üê≥ Creating container for image mongo:6.0
2025/08/26 23:14:26 ‚úÖ Container created: dd2c032082c3
2025/08/26 23:14:26 üê≥ Starting container: dd2c032082c3
2025/08/26 23:14:27 ‚úÖ Container started: dd2c032082c3
2025/08/26 23:14:27 ‚è≥ Waiting for container id dd2c032082c3 image: mongo:6.0. Waiting for: &{Port:27017/tcp timeout:<nil> PollInterval:100ms skipInternalCheck:false skipExternalCheck:false}
2025/08/26 23:14:27 üîî Container is ready: dd2c032082c3
2025/08/26 23:14:27 üê≥ Creating container for image redis:7.0
2025/08/26 23:14:27 ‚úÖ Container created: 333b432f7e2e
2025/08/26 23:14:27 üê≥ Starting container: 333b432f7e2e
2025/08/26 23:14:27 ‚úÖ Container started: 333b432f7e2e
2025/08/26 23:14:27 ‚è≥ Waiting for container id 333b432f7e2e image: redis:7.0. Waiting for: &{Port:6379/tcp timeout:<nil> PollInterval:100ms skipInternalCheck:false skipExternalCheck:false}
2025/08/26 23:14:28 üîî Container is ready: 333b432f7e2e
2025/08/26 23:14:28 üê≥ Creating container for image minio/minio:RELEASE.2025-04-22T22-12-26Z
2025/08/26 23:14:28 ‚úÖ Container created: fbb4a342ad9d
2025/08/26 23:14:28 üê≥ Starting container: fbb4a342ad9d
2025/08/26 23:14:28 ‚úÖ Container started: fbb4a342ad9d
2025/08/26 23:14:28 ‚è≥ Waiting for container id fbb4a342ad9d image: minio/minio:RELEASE.2025-04-22T22-12-26Z. Waiting for: &{timeout:<nil> Log:API: http:// IsRegexp:false Occurrence:1 PollInterval:100ms check:<nil> submatchCallback:<nil> re:<nil> log:[]}
2025/08/26 23:14:28 üîî Container is ready: fbb4a342ad9d
2025/08/26 23:14:28 üê≥ Creating container for image bitnami/kafka:3.6.1
2025/08/26 23:14:28 ‚úÖ Container created: 9e6aa44b64de
2025/08/26 23:14:28 üê≥ Starting container: 9e6aa44b64de
2025/08/26 23:14:28 ‚úÖ Container started: 9e6aa44b64de
2025/08/26 23:14:28 ‚è≥ Waiting for container id 9e6aa44b64de image: bitnami/kafka:3.6.1. Waiting for: &{Port:9092/tcp timeout:0x1400059b900 PollInterval:100ms skipInternalCheck:false skipExternalCheck:false}
2025/08/26 23:14:32 üîî Container is ready: 9e6aa44b64de
[32mINFO[0m Connected to MongoDB 2025-08-26 23:14:33
[32mINFO[0m ‚úÖ Connected to Redis at localhost:52413 (DB=0) 2025-08-26 23:14:33
[32mINFO[0m Redis connected 2025-08-26 23:14:33
[32mINFO[0m ‚úÖ Successfully connected to MinIO 2025-08-26 23:14:33
[32mINFO[0m FileStorage connected: bucket=test-bucket host=localhost 2025-08-26 23:14:33
%3|1756232073.429|FAIL|rdkafka#producer-1| [thrd:localhost:9092/bootstrap]: localhost:9092/bootstrap: Connect to ipv6#[::1]:9092 failed: Connection refused (after 0ms in state CONNECT)
[32mINFO[0m Kafka producer initialized for topic: post-events 2025-08-26 23:14:33
[32mINFO[0m Kafka broker: localhost:9092 2025-08-26 23:14:33
=== RUN   TestPostLifecycle
[32mINFO[0m KafkaConsumer started on topics: [post-events] 2025-08-26 23:14:33
[32mINFO[0m Message produced to topic post-events: {"type":"PostCreated","data":{"post_id":"aefda36c-a054-4c39-bf14-50ca7a8d373b"}} 2025-08-26 23:14:33
[32mINFO[0m PostCreated event published successfully 2025-08-26 23:14:33
[32mINFO[0m Fetched posts from DB and cached 2025-08-26 23:14:33
[32mINFO[0m Fetched post aefda36c-a054-4c39-bf14-50ca7a8d373b from DB and cached 2025-08-26 23:14:33
[32mINFO[0m Message produced to topic post-events: {"type":"PostUpdated","data":{"post_id":"aefda36c-a054-4c39-bf14-50ca7a8d373b","media_new_urls":null,"media_old_urls":["http://localhost:52416/test-bucket/img.png"],"files_new_urls":null,"files_old_urls":["http://localhost:52416/test-bucket/test_1.pdf"]}} 2025-08-26 23:14:33
[32mINFO[0m PostUpdated event published successfully 2025-08-26 23:14:33
[32mINFO[0m Received message: {"type":"PostCreated","data":{"post_id":"aefda36c-a054-4c39-bf14-50ca7a8d373b"}} 2025-08-26 23:14:37
[33mWARNING[0m No handler registered for event type: PostCreated 2025-08-26 23:14:37
[32mINFO[0m Received message: {"type":"PostUpdated","data":{"post_id":"aefda36c-a054-4c39-bf14-50ca7a8d373b","media_new_urls":null,"media_old_urls":["http://localhost:52416/test-bucket/img.png"],"files_new_urls":null,"files_old_urls":["http://localhost:52416/test-bucket/test_1.pdf"]}} 2025-08-26 23:14:37
[32mINFO[0m Post aefda36c-a054-4c39-bf14-50ca7a8d373b cache updated 2025-08-26 23:14:37
[32mINFO[0m Message produced to topic post-events: {"type":"PostDeleted","data":{"post_id":"aefda36c-a054-4c39-bf14-50ca7a8d373b","media_urls":null,"files_urls":null}} 2025-08-26 23:14:38
[32mINFO[0m PostDeleted event published successfully 2025-08-26 23:14:38
[32mINFO[0m Received message: {"type":"PostDeleted","data":{"post_id":"aefda36c-a054-4c39-bf14-50ca7a8d373b","media_urls":null,"files_urls":null}} 2025-08-26 23:14:38
[32mINFO[0m Post aefda36c-a054-4c39-bf14-50ca7a8d373b deleted and cleaned up 2025-08-26 23:14:38
[32mINFO[0m ‚úÖ Cache updated successfully! 2025-08-26 23:14:38
[31mERROR[0m Error fetching post aefda36c-a054-4c39-bf14-50ca7a8d373b: mongo: no documents in result 2025-08-26 23:14:43
[32mINFO[0m Shutting down consumer... 2025-08-26 23:14:43
[32mINFO[0m Kafka consumer closed gracefully 2025-08-26 23:14:43
--- PASS: TestPostLifecycle (10.10s)
PASS
ok  	postService/tests/integration	18.097s
?   	postService/tests/testutil	[no test files]
